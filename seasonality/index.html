<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>역대 암호화폐 퍼포먼스 | Herdvibe</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600;700&family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    /* ===== HERDVIBE DESIGN TOKENS ===== */
    :root {
      --hv-primary:#3b82f6;--hv-primary-light:#60a5fa;--hv-primary-dark:#2563eb;
      --hv-primary-glow:rgba(59,130,246,0.12);
      --hv-up:#22c55e;--hv-up-bg:rgba(34,197,94,0.1);
      --hv-down:#ef4444;--hv-down-bg:rgba(239,68,68,0.1);
      --hv-warning:#f59e0b;--hv-warning-bg:rgba(245,158,11,0.1);
      --hv-neutral:#6b7280;
      --hv-bg-base:#000;--hv-bg-surface:#0a0a0a;--hv-bg-card:#111;
      --hv-bg-card-hover:#181818;--hv-bg-elevated:#1a1a1a;
      --hv-text-primary:#e5e5e5;--hv-text-secondary:#8a8a8a;
      --hv-text-tertiary:#555;--hv-text-muted:#3a3a3a;
      --hv-border:rgba(255,255,255,0.06);--hv-border-strong:rgba(255,255,255,0.12);
      --hv-font-display:'Plus Jakarta Sans',sans-serif;
      --hv-font-body:'Noto Sans KR',-apple-system,BlinkMacSystemFont,sans-serif;
      --hv-font-mono:'JetBrains Mono','SF Mono',monospace;
      --hv-space-xs:8px;--hv-space-sm:12px;--hv-space-md:16px;
      --hv-space-lg:24px;--hv-space-xl:32px;--hv-space-2xl:48px;
      --hv-radius-sm:6px;--hv-radius-md:10px;--hv-radius-lg:14px;
      --hv-shadow-sm:0 1px 3px rgba(0,0,0,.5);--hv-shadow-lg:0 8px 32px rgba(0,0,0,.7);
      --hv-transition-fast:150ms ease;--hv-transition:250ms ease;
      --hv-max-width:1280px;--hv-header-height:60px;--hv-sidebar-width:300px;
    }

    /* ===== RESET ===== */
    *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
    html{font-size:16px;scroll-behavior:smooth;-webkit-font-smoothing:antialiased;-webkit-text-size-adjust:100%;overflow-x:hidden}
    body{font-family:var(--hv-font-body);background:var(--hv-bg-base);color:var(--hv-text-primary);line-height:1.6;min-height:100vh;overflow-x:hidden}
    a{color:var(--hv-primary-light);text-decoration:none}
    ::selection{background:var(--hv-primary);color:#fff}
    ::-webkit-scrollbar{width:5px;height:5px}
    ::-webkit-scrollbar-track{background:var(--hv-bg-base)}
    ::-webkit-scrollbar-thumb{background:#333;border-radius:3px}

    /* ===== HEADER ===== */
    .hv-header{position:sticky;top:0;z-index:100;height:var(--hv-header-height);background:rgba(0,0,0,.9);backdrop-filter:blur(20px) saturate(180%);-webkit-backdrop-filter:blur(20px) saturate(180%);border-bottom:1px solid var(--hv-border);display:flex;align-items:center;padding:0 var(--hv-space-lg)}
    .hv-header-inner{width:100%;max-width:var(--hv-max-width);margin:0 auto;display:flex;align-items:center;justify-content:space-between;gap:var(--hv-space-md)}
    .hv-logo{display:flex;align-items:center;gap:10px;font-family:var(--hv-font-display);font-weight:800;font-size:1.15rem;color:var(--hv-text-primary);text-decoration:none;white-space:nowrap;letter-spacing:-.02em}
    .hv-logo-mark{width:28px;height:28px;background:linear-gradient(135deg,var(--hv-primary),#6366f1);border-radius:7px;flex-shrink:0}
    .hv-header-center{display:flex;flex-direction:column;min-width:0}
    .hv-header-center h1{font-family:var(--hv-font-display);font-size:.938rem;font-weight:600;color:var(--hv-text-primary);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .hv-header-category{font-size:.7rem;color:var(--hv-text-tertiary);font-weight:500;text-transform:uppercase;letter-spacing:.08em}
    .hv-header-right{display:flex;align-items:center;gap:var(--hv-space-xs);flex-shrink:0}
    .hv-update-badge{font-family:var(--hv-font-mono);font-size:.688rem;color:var(--hv-text-tertiary);white-space:nowrap;display:flex;align-items:center;gap:6px}
    .hv-live-dot{width:5px;height:5px;background:var(--hv-up);border-radius:50%;animation:pulse 2s infinite}
    @keyframes pulse{0%,100%{opacity:1}50%{opacity:.3}}

    /* ===== LAYOUT ===== */
    .hv-page{max-width:var(--hv-max-width);margin:0 auto;padding:var(--hv-space-lg)}
    .hv-layout{display:grid;grid-template-columns:1fr var(--hv-sidebar-width);gap:var(--hv-space-lg)}
    .hv-main{min-width:0}
    .hv-side{display:flex;flex-direction:column;gap:var(--hv-space-lg)}

    /* ===== CARDS ===== */
    .hv-card{background:var(--hv-bg-card);border:1px solid var(--hv-border);border-radius:var(--hv-radius-lg);overflow:hidden}
    .hv-card-head{display:flex;align-items:center;justify-content:space-between;padding:14px var(--hv-space-lg);border-bottom:1px solid var(--hv-border)}
    .hv-card-head h2{font-size:.875rem;font-weight:600;color:var(--hv-text-primary)}
    .hv-card-body{padding:var(--hv-space-lg)}

    /* ===== ARTICLE ===== */
    .hv-article{background:var(--hv-bg-card);border:1px solid var(--hv-border);border-radius:var(--hv-radius-lg);padding:var(--hv-space-xl);margin-bottom:var(--hv-space-lg)}
    .hv-article h2{font-family:var(--hv-font-display);font-size:1.05rem;font-weight:700;color:var(--hv-text-primary);margin-bottom:var(--hv-space-md)}
    .hv-article p{font-size:.9rem;line-height:1.8;color:var(--hv-text-secondary);margin-bottom:var(--hv-space-md)}
    .hv-article p:last-child{margin-bottom:0}
    .hv-article strong{color:var(--hv-text-primary);font-weight:600}
    .hv-callout{background:var(--hv-primary-glow);border-left:3px solid var(--hv-primary);padding:14px 20px;border-radius:0 var(--hv-radius-sm) var(--hv-radius-sm) 0;margin:var(--hv-space-lg) 0}
    .hv-callout p{color:var(--hv-text-primary);margin:0;font-size:.875rem}

    /* ===== AD SLOTS ===== */
    .hv-ad{display:flex;align-items:center;justify-content:center;background:var(--hv-bg-surface);border:1px dashed rgba(255,255,255,.04);border-radius:var(--hv-radius-md);position:relative;margin:var(--hv-space-lg) 0;color:var(--hv-text-muted);font-size:.7rem}
    .hv-ad--top{min-height:90px;max-width:728px;margin-left:auto;margin-right:auto}
    .hv-ad--side{min-height:250px;max-width:300px}
    .hv-ad--inline{min-height:70px}
    .hv-ad--mobile{min-height:100px;display:none}
    .hv-ad::before{content:'Ad';position:absolute;top:4px;left:8px;font-size:.563rem;color:rgba(255,255,255,.12);text-transform:uppercase;letter-spacing:.1em}

    /* ===== SIDEBAR NAV ===== */
    .side-nav{background:var(--hv-bg-card);border:1px solid var(--hv-border);border-radius:var(--hv-radius-lg);overflow:hidden}
    .side-nav-title{padding:12px 20px;font-size:.7rem;font-weight:600;color:var(--hv-text-tertiary);text-transform:uppercase;letter-spacing:.06em;border-bottom:1px solid var(--hv-border)}
    .side-nav a{display:block;padding:10px 20px;font-size:.838rem;color:var(--hv-text-secondary);border-bottom:1px solid var(--hv-border);transition:all var(--hv-transition-fast)}
    .side-nav a:last-child{border-bottom:none}
    .side-nav a:hover{background:var(--hv-bg-card-hover);color:var(--hv-text-primary)}
    .side-nav a.active{color:var(--hv-primary-light);background:var(--hv-primary-glow);border-left:3px solid var(--hv-primary)}

    /* ===== SHARE BAR ===== */
    .share-bar{display:flex;align-items:center;justify-content:space-between;padding:12px var(--hv-space-lg);border-top:1px solid var(--hv-border);background:var(--hv-bg-surface)}
    .share-bar-preview{font-size:.75rem;color:var(--hv-text-tertiary);overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:50%;line-height:1.4;font-family:var(--hv-font-mono)}
    .share-bar-preview span{color:var(--hv-text-secondary);font-weight:500}
    .share-bar-buttons{display:flex;align-items:center;gap:6px;flex-shrink:0}
    .share-btn{display:inline-flex;align-items:center;gap:6px;padding:7px 14px;border-radius:6px;font-size:.75rem;font-weight:600;font-family:var(--hv-font-body);cursor:pointer;transition:all var(--hv-transition-fast);border:1px solid var(--hv-border-strong);background:var(--hv-bg-card);color:#999;white-space:nowrap}
    .share-btn:hover{transform:translateY(-1px);box-shadow:var(--hv-shadow-sm);color:var(--hv-text-primary)}
    .share-btn svg{flex-shrink:0}
    .share-btn--x:hover{border-color:#fff;color:#fff;background:#111}
    .share-btn--kakao:hover{border-color:#FEE500;color:#191919;background:#FEE500}
    .share-btn--tg:hover{border-color:#26A5E4;color:#fff;background:rgba(38,165,228,.15)}
    .share-btn--copy:hover{border-color:var(--hv-primary);color:var(--hv-primary-light);background:var(--hv-primary-glow)}

    /* ===== TOAST ===== */
    .toast-wrap{position:fixed;bottom:20px;right:20px;z-index:200;display:flex;flex-direction:column;gap:8px}
    .toast{background:var(--hv-bg-elevated);border:1px solid var(--hv-border-strong);border-radius:var(--hv-radius-md);padding:10px 18px;font-size:.788rem;color:var(--hv-text-primary);box-shadow:var(--hv-shadow-lg);animation:toastIn .3s ease;border-left:3px solid var(--hv-up)}
    @keyframes toastIn{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}

    /* ===== DASHBOARD-SPECIFIC: COIN TABS ===== */
    .coin-tabs{display:flex;gap:6px;margin-bottom:var(--hv-space-md);overflow-x:auto;-webkit-overflow-scrolling:touch;scrollbar-width:none;padding:2px 0}
    .coin-tabs::-webkit-scrollbar{display:none}
    .coin-tab{display:flex;align-items:center;gap:8px;padding:10px 14px;background:var(--hv-bg-card);border:1px solid var(--hv-border);border-radius:var(--hv-radius-md);cursor:pointer;transition:all .2s ease;min-width:fit-content;flex-shrink:0;-webkit-tap-highlight-color:transparent}
    .coin-tab:hover{background:var(--hv-bg-card-hover);border-color:var(--hv-border-strong)}
    .coin-tab.active{background:var(--hv-bg-elevated);border-color:var(--hv-warning);box-shadow:0 0 15px rgba(245,158,11,0.1)}
    .coin-icon{width:28px;height:28px;border-radius:50%;overflow:hidden;display:flex;align-items:center;justify-content:center;flex-shrink:0}
    .coin-icon img{width:100%;height:100%;object-fit:cover}
    .coin-icon.eth-bg{background:#fff}
    .coin-info{display:flex;flex-direction:column;align-items:flex-start}
    .coin-name{font-weight:600;font-size:.85rem;color:var(--hv-text-primary)}
    .coin-price{font-family:var(--hv-font-mono);font-size:.75rem;color:var(--hv-text-secondary)}
    .coin-price.loading{color:var(--hv-text-muted)}

    /* ===== CHART SECTIONS ===== */
    .hv-chart{position:relative;background:var(--hv-bg-card);border:1px solid var(--hv-border);border-radius:var(--hv-radius-lg);overflow:hidden;margin-bottom:var(--hv-space-lg)}
    .hv-chart-head{display:flex;align-items:center;justify-content:space-between;padding:14px var(--hv-space-lg);border-bottom:1px solid var(--hv-border);flex-wrap:wrap;gap:var(--hv-space-xs)}
    .hv-chart-head h3{font-family:var(--hv-font-display);font-size:.875rem;font-weight:600;color:var(--hv-text-primary)}
    .chart-legend{display:flex;gap:12px;flex-wrap:wrap}
    .legend-item{display:flex;align-items:center;gap:5px;font-size:.7rem;color:var(--hv-text-secondary)}
    .legend-dot{width:10px;height:10px;border-radius:50%}
    .legend-dot.best{background:var(--hv-up)}
    .legend-dot.worst{background:var(--hv-down)}
    .legend-dot.avg{background:transparent;border:2px dashed #888}
    .legend-dot.current{background:var(--hv-warning)}
    .legend-dot.selected{background:var(--hv-primary-light)}
    .chart-canvas-wrap{height:320px;position:relative;padding:var(--hv-space-md) var(--hv-space-lg)}

    /* ===== HEATMAP ===== */
    .heatmap-wrap{overflow-x:auto;-webkit-overflow-scrolling:touch;scrollbar-width:none}
    .heatmap-wrap::-webkit-scrollbar{display:none}
    .heatmap-table{width:100%;border-collapse:collapse;font-family:var(--hv-font-mono);font-size:.7rem;min-width:700px}
    .heatmap-table th{padding:8px 4px;text-align:center;font-weight:500;color:var(--hv-text-tertiary);border-bottom:1px solid var(--hv-border);position:sticky;top:0;background:var(--hv-bg-card);font-size:.65rem}
    .heatmap-table td{padding:6px 3px;text-align:center;border-bottom:1px solid var(--hv-border);transition:all .15s ease}
    .heatmap-table tr{cursor:pointer;transition:background .15s ease}
    .heatmap-table tbody tr:hover{background:var(--hv-bg-card-hover)}
    .heatmap-table tbody tr.selected{background:rgba(59,130,246,0.15)}
    .heatmap-table .year-cell{font-weight:600;color:var(--hv-text-primary);text-align:left;padding-left:10px;font-size:.75rem}
    .heatmap-cell{border-radius:3px;padding:4px 2px;font-weight:500;font-size:.65rem}
    .heatmap-cell.positive{background:rgba(34,197,94,0.15);color:var(--hv-up)}
    .heatmap-cell.negative{background:rgba(239,68,68,0.15);color:var(--hv-down)}
    .heatmap-cell.neutral{color:var(--hv-text-muted)}
    .heatmap-cell.current-month{border:2px solid var(--hv-warning)}
    .heatmap-table tfoot{border-top:2px solid var(--hv-border)}
    .heatmap-table tfoot tr{background:var(--hv-bg-elevated)}
    .heatmap-table tfoot td{padding:8px 4px;text-align:center;font-weight:600;font-size:.65rem}
    .heatmap-table tfoot .stat-label{text-align:left;padding-left:10px;font-size:.7rem}
    .heatmap-table tfoot .stat-best{color:var(--hv-up)}
    .heatmap-table tfoot .stat-worst{color:var(--hv-down)}
    .heatmap-table tfoot .stat-avg{color:var(--hv-text-secondary)}

    .loading-overlay{display:flex;align-items:center;justify-content:center;height:300px;color:var(--hv-text-muted)}
    .spinner{width:30px;height:30px;border:3px solid var(--hv-border-strong);border-top-color:var(--hv-warning);border-radius:50%;animation:spin 1s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}

    /* ===== RESPONSIVE ===== */
    @media(max-width:1024px){
      .hv-layout{grid-template-columns:1fr}
      .hv-side{order:2}
      .hv-ad--side{max-width:100%}
    }
    @media(max-width:768px){
      :root{--hv-header-height:52px}
      .hv-page{padding:var(--hv-space-md)}
      .hv-header{padding:0 var(--hv-space-md)}
      .hv-update-badge{display:none}
      .hv-article{padding:var(--hv-space-lg)}
      .hv-ad--top{display:none}
      .hv-ad--mobile{display:flex}
      .chart-canvas-wrap{height:260px}
      .share-bar{flex-direction:column;gap:10px;align-items:stretch}
      .share-bar-preview{max-width:100%}
      .share-bar-buttons{justify-content:center;flex-wrap:wrap}
      .share-btn span.label-text{display:none}
      .share-btn{padding:8px 10px}
      .coin-tab{padding:8px 10px;gap:6px}
      .coin-icon{width:24px;height:24px}
      .coin-name{font-size:.75rem}
      .coin-price{font-size:.65rem}
      .hv-chart-head{flex-direction:column;align-items:flex-start;gap:8px}
    }
    @media(max-width:520px){
      .hv-page{padding:12px 10px 24px}
      .chart-canvas-wrap{height:240px;padding:var(--hv-space-sm)}
      .hv-chart-head{padding:12px 14px}
      .heatmap-table{font-size:.6rem;min-width:600px}
      .heatmap-table th{font-size:.55rem}
      .heatmap-cell{font-size:.55rem}
    }
    @media(max-width:380px){
      .coin-tab{padding:6px 8px}
      .coin-icon{width:22px;height:22px}
      .coin-name{font-size:.7rem}
      .coin-price{font-size:.6rem}
      .chart-canvas-wrap{height:220px}
      .hv-header-center h1{font-size:.838rem}
    }
  </style>
</head>
<body>

  <!-- ===== HEADER ===== -->
  <header class="hv-header">
    <div class="hv-header-inner">
      <a href="/" class="hv-logo"><span class="hv-logo-mark"></span><span>Herdvibe</span></a>
      <div class="hv-header-center">
        <h1>역대 암호화폐 퍼포먼스</h1>
        <span class="hv-header-category">Crypto</span>
      </div>
      <div class="hv-header-right">
        <div class="hv-update-badge"><span class="hv-live-dot"></span><span>실시간</span></div>
      </div>
    </div>
  </header>

  <div class="hv-page">

    <!-- ===== ARTICLE ===== -->
    <div class="hv-article">
      <h2>암호화폐 시즌널리티 분석</h2>
      <p>이 대시보드는 <strong>BTC, ETH, SOL, XRP, BNB</strong>의 역대 월별 수익률 데이터를 시각화하여 <strong>시즌널리티(계절성) 패턴</strong>을 분석합니다. 과거 데이터를 기반으로 특정 월에 어떤 코인이 얼마나 올랐는지, 떨어졌는지를 한눈에 확인할 수 있습니다.</p>
      <div class="hv-callout"><p><strong>활용법</strong> — 히트맵에서 특정 연도를 클릭하면 해당 연도의 월별 가격 흐름이 차트에 파란선으로 표시됩니다. 역대 최고/최저/평균과 비교하여 현재 시장 위치를 파악할 수 있습니다.</p></div>
      <p>데이터는 매일 자동으로 업데이트됩니다. 과거 실적이 미래 수익을 보장하지 않으므로 투자 참고용으로만 활용하세요.</p>
    </div>

    <!-- ADS -->
    <div class="hv-ad hv-ad--top">광고 영역</div>
    <div class="hv-ad hv-ad--mobile">모바일 광고</div>

    <!-- ===== LAYOUT ===== -->
    <div class="hv-layout">
      <div class="hv-main">

        <!-- Coin Tabs -->
        <nav class="coin-tabs">
          <div class="coin-tab active" data-coin="bitcoin">
            <div class="coin-icon"><img src="https://raw.githubusercontent.com/kittycapital/crypto-history/main/assets/bitcoin.svg" alt="BTC"></div>
            <div class="coin-info"><span class="coin-name">Bitcoin</span><span class="coin-price loading" id="price-bitcoin">연결중...</span></div>
          </div>
          <div class="coin-tab" data-coin="ethereum">
            <div class="coin-icon"><img src="https://raw.githubusercontent.com/kittycapital/crypto-history/main/assets/ethereum.png" alt="ETH"></div>
            <div class="coin-info"><span class="coin-name">Ethereum</span><span class="coin-price loading" id="price-ethereum">연결중...</span></div>
          </div>
          <div class="coin-tab" data-coin="solana">
            <div class="coin-icon"><img src="https://raw.githubusercontent.com/kittycapital/crypto-history/main/assets/solana.png" alt="SOL"></div>
            <div class="coin-info"><span class="coin-name">Solana</span><span class="coin-price loading" id="price-solana">연결중...</span></div>
          </div>
          <div class="coin-tab" data-coin="xrp">
            <div class="coin-icon"><img src="https://raw.githubusercontent.com/kittycapital/crypto-history/main/assets/xrp.svg" alt="XRP"></div>
            <div class="coin-info"><span class="coin-name">XRP</span><span class="coin-price loading" id="price-xrp">연결중...</span></div>
          </div>
          <div class="coin-tab" data-coin="bnb">
            <div class="coin-icon"><img src="https://raw.githubusercontent.com/kittycapital/crypto-history/main/assets/bnb.png" alt="BNB"></div>
            <div class="coin-info"><span class="coin-name">BNB</span><span class="coin-price loading" id="price-bnb">연결중...</span></div>
          </div>
        </nav>

        <!-- Monthly Performance Chart -->
        <div class="hv-chart">
          <div class="hv-chart-head">
            <div><h3 id="chart-title">Bitcoin 2월, 과거엔 어땠을까?</h3></div>
            <div class="chart-legend">
              <div class="legend-item"><span class="legend-dot best"></span>역대 최고</div>
              <div class="legend-item"><span class="legend-dot worst"></span>역대 최저</div>
              <div class="legend-item"><span class="legend-dot avg"></span>평균</div>
              <div class="legend-item"><span class="legend-dot current"></span>현재 <span id="current-year">2026</span></div>
              <div class="legend-item"><span class="legend-dot selected"></span>선택됨</div>
            </div>
          </div>
          <div class="chart-canvas-wrap"><canvas id="performanceChart"></canvas></div>

          <!-- SHARE BAR -->
          <div class="share-bar">
            <div class="share-bar-preview" id="sharePreview"><span>BTC 월별 시즌널리티 분석</span> — herdvibe.com</div>
            <div class="share-bar-buttons">
              <button class="share-btn share-btn--x" onclick="doShare('twitter')"><svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg><span class="label-text">트위터</span></button>
              <button class="share-btn share-btn--kakao" onclick="doShare('kakao')"><svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M12 3C6.477 3 2 6.463 2 10.691c0 2.724 1.8 5.112 4.508 6.458l-1.148 4.265a.5.5 0 0 0 .764.533l4.94-3.26c.304.02.612.03.936.03 5.523 0 10-3.462 10-7.735C22 6.463 17.523 3 12 3z"/></svg><span class="label-text">카카오톡</span></button>
              <button class="share-btn share-btn--tg" onclick="doShare('telegram')"><svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.479.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"/></svg><span class="label-text">텔레그램</span></button>
              <button class="share-btn share-btn--copy" onclick="doShare('link')"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg><span class="label-text">링크 복사</span></button>
            </div>
          </div>
        </div>

        <!-- Yearly Scenario Chart -->
        <div class="hv-chart">
          <div class="hv-chart-head">
            <div><h3 id="yearly-chart-title">2026년 가격 시나리오</h3></div>
            <div class="chart-legend">
              <div class="legend-item"><span class="legend-dot best"></span>역대 최고</div>
              <div class="legend-item"><span class="legend-dot worst"></span>역대 최저</div>
              <div class="legend-item"><span class="legend-dot avg"></span>평균</div>
              <div class="legend-item"><span class="legend-dot current"></span>현재 2026</div>
            </div>
          </div>
          <div class="chart-canvas-wrap"><canvas id="yearlyChart"></canvas></div>

          <!-- SHARE BAR -->
          <div class="share-bar">
            <div class="share-bar-preview" id="sharePreview2"><span>2026년 가격 시나리오</span> — herdvibe.com</div>
            <div class="share-bar-buttons">
              <button class="share-btn share-btn--x" onclick="doShare2('twitter')"><svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg><span class="label-text">트위터</span></button>
              <button class="share-btn share-btn--kakao" onclick="doShare2('kakao')"><svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M12 3C6.477 3 2 6.463 2 10.691c0 2.724 1.8 5.112 4.508 6.458l-1.148 4.265a.5.5 0 0 0 .764.533l4.94-3.26c.304.02.612.03.936.03 5.523 0 10-3.462 10-7.735C22 6.463 17.523 3 12 3z"/></svg><span class="label-text">카카오톡</span></button>
              <button class="share-btn share-btn--tg" onclick="doShare2('telegram')"><svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.479.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"/></svg><span class="label-text">텔레그램</span></button>
              <button class="share-btn share-btn--copy" onclick="doShare2('link')"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg><span class="label-text">링크 복사</span></button>
            </div>
          </div>
        </div>

        <!-- AD: Inline -->
        <div class="hv-ad hv-ad--inline">광고 영역</div>

        <!-- Heatmap -->
        <div class="hv-card">
          <div class="hv-card-head">
            <h2>월별 수익률 히트맵</h2>
            <span style="font-family:var(--hv-font-mono);font-size:.64rem;color:var(--hv-text-tertiary)">연도 클릭 시 차트 반영</span>
          </div>
          <div class="hv-card-body" style="padding:0">
            <div class="heatmap-wrap">
              <table class="heatmap-table" id="heatmapTable">
                <thead><tr><th>연도</th><th>1월</th><th>2월</th><th>3월</th><th>4월</th><th>5월</th><th>6월</th><th>7월</th><th>8월</th><th>9월</th><th>10월</th><th>11월</th><th>12월</th></tr></thead>
                <tbody id="heatmapBody"></tbody>
                <tfoot id="heatmapFoot"></tfoot>
              </table>
            </div>
          </div>
        </div>

        <!-- Education Article -->
        <div class="hv-article" style="margin-top:var(--hv-space-lg)">
          <h2>시즌널리티란?</h2>
          <p><strong>시즌널리티(Seasonality)</strong>란 특정 자산이 매년 비슷한 시기에 반복적인 가격 패턴을 보이는 현상입니다. 예를 들어 비트코인은 역사적으로 4분기(10~12월)에 강세를 보이는 경향이 있으며, 이는 연말 기관 자금 유입과 관련이 있다는 분석이 있습니다.</p>
          <p><strong>활용 시 주의사항</strong> — 시즌널리티는 확률적 경향일 뿐, 매년 동일하게 반복되지는 않습니다. 거시경제 상황, 규제 변화, 기술적 이벤트(반감기 등)에 따라 패턴이 깨질 수 있으므로, 다른 분석 도구와 함께 참고하는 것이 중요합니다.</p>
        </div>

        <!-- AD: Bottom -->
        <div class="hv-ad hv-ad--top">광고 영역</div>

      </div>

      <!-- ===== SIDEBAR ===== -->
      <div class="hv-side">
        <div class="hv-ad hv-ad--side">사이드 광고</div>
        <nav class="side-nav" id="hv-side-nav">
          <div class="side-nav-title">관련 대시보드</div>
          <a href="/crypto-prediction/">크립토 가격 예측</a>
          <a href="#" class="active">시즌널리티 분석</a>
          <a href="#" style="opacity:0.4;cursor:default">BTC 고래 추적</a>
          <a href="#" style="opacity:0.4;cursor:default">김치 프리미엄</a>
          <a href="#" style="opacity:0.4;cursor:default">DeFi 프로토콜 분석</a>
        </nav>
        <div class="hv-card">
          <div class="hv-card-head"><h2>이번 달 요약</h2></div>
          <div class="hv-card-body">
            <div style="display:flex;flex-direction:column;gap:14px">
              <div style="display:flex;justify-content:space-between;align-items:center"><span style="font-size:.788rem;color:var(--hv-text-tertiary)">역대 평균</span><span id="side-avg" style="font-family:var(--hv-font-mono);font-size:.838rem;color:var(--hv-text-primary)">--</span></div>
              <div style="display:flex;justify-content:space-between;align-items:center"><span style="font-size:.788rem;color:var(--hv-text-tertiary)">역대 최고</span><span id="side-best" style="font-family:var(--hv-font-mono);font-size:.838rem;color:var(--hv-up)">--</span></div>
              <div style="display:flex;justify-content:space-between;align-items:center"><span style="font-size:.788rem;color:var(--hv-text-tertiary)">역대 최저</span><span id="side-worst" style="font-family:var(--hv-font-mono);font-size:.838rem;color:var(--hv-down)">--</span></div>
              <div style="display:flex;justify-content:space-between;align-items:center"><span style="font-size:.788rem;color:var(--hv-text-tertiary)">상승 확률</span><span id="side-winrate" style="font-family:var(--hv-font-mono);font-size:.838rem;color:var(--hv-text-primary)">--</span></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    /* =========================================================
       HERDVIBE COMMON: SHARE, TOAST, WATERMARK
       ========================================================= */
    function doShare(p) {
      var u = location.href;
      var coinName = COIN_NAMES_KR[currentCoin] || '암호화폐';
      var t = coinName + ' 시즌널리티 분석 — 역대 월별 수익률 비교 | herdvibe.com';
      if (p === 'link') { navigator.clipboard.writeText(u).then(function() { toast('링크가 복사되었습니다'); }); }
      else if (p === 'twitter') { window.open('https://twitter.com/intent/tweet?text=' + encodeURIComponent(t) + '&url=' + encodeURIComponent(u), '_blank'); }
      else if (p === 'telegram') { window.open('https://t.me/share/url?url=' + encodeURIComponent(u) + '&text=' + encodeURIComponent(t), '_blank'); }
      else { toast('카카오톡 공유는 앱 키 설정 후 사용 가능합니다'); }
    }

    function doShare2(p) {
      var u = location.href;
      var coinName = COIN_NAMES_KR[currentCoin] || '암호화폐';
      var yr = new Date().getFullYear();
      var t = yr + '년 ' + coinName + ' 가격 시나리오 — 역대 패턴 기반 분석 | herdvibe.com';
      if (p === 'link') { navigator.clipboard.writeText(u).then(function() { toast('링크가 복사되었습니다'); }); }
      else if (p === 'twitter') { window.open('https://twitter.com/intent/tweet?text=' + encodeURIComponent(t) + '&url=' + encodeURIComponent(u), '_blank'); }
      else if (p === 'telegram') { window.open('https://t.me/share/url?url=' + encodeURIComponent(u) + '&text=' + encodeURIComponent(t), '_blank'); }
      else { toast('카카오톡 공유는 앱 키 설정 후 사용 가능합니다'); }
    }

    function toast(msg) {
      var c = document.querySelector('.toast-wrap');
      if (!c) { c = document.createElement('div'); c.className = 'toast-wrap'; document.body.appendChild(c); }
      var t = document.createElement('div'); t.className = 'toast'; t.textContent = msg; c.appendChild(t);
      setTimeout(function() { t.style.opacity = '0'; t.style.transform = 'translateY(12px)'; t.style.transition = '.3s'; setTimeout(function() { t.remove(); }, 300); }, 3000);
    }

    function updateSharePreview() {
      var coinName = COIN_NAMES_KR[currentCoin] || '암호화폐';
      document.getElementById('sharePreview').innerHTML = '<span>' + coinName + ' 월별 시즌널리티 분석</span> — herdvibe.com';
      var yr = new Date().getFullYear();
      document.getElementById('sharePreview2').innerHTML = '<span>' + yr + '년 ' + coinName + ' 가격 시나리오</span> — herdvibe.com';
    }

    var watermarkPlugin = {
      id: 'herdvibeWatermark',
      beforeDraw: function(chart) {
        var ctx = chart.ctx, ca = chart.chartArea;
        if (!ca) return;
        ctx.save();
        ctx.font = '700 34px "Plus Jakarta Sans", sans-serif';
        ctx.fillStyle = 'rgba(255, 255, 255, 0.035)';
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        ctx.fillText('Herdvibe.com', (ca.left + ca.right) / 2, (ca.top + ca.bottom) / 2);
        ctx.restore();
      }
    };

    /* =========================================================
       ORIGINAL DASHBOARD LOGIC — 100% PRESERVED
       ========================================================= */

    // Global state
    var currentCoin = 'bitcoin';
    var coinData = {};
    var chart = null;
    var yearlyChart = null;
    var selectedYear = null;

    var COIN_SYMBOLS = {
      bitcoin: 'btcusdt', ethereum: 'ethusdt', solana: 'solusdt', xrp: 'xrpusdt', bnb: 'bnbusdt'
    };

    var COIN_NAMES_KR = {
      bitcoin: '비트코인', ethereum: '이더리움', solana: '솔라나', xrp: 'XRP', bnb: 'BNB'
    };

    var MONTH_NAMES_KR = ['1월', '2월', '3월', '4월', '5월', '6월', '7월', '8월', '9월', '10월', '11월', '12월'];

    Chart.defaults.color = '#555';
    Chart.defaults.borderColor = 'rgba(255,255,255,0.06)';
    Chart.defaults.font.family = "'Noto Sans KR', sans-serif";

    // Binance WebSocket for live prices
    function initWebSocket() {
      var streams = Object.values(COIN_SYMBOLS).map(function(s) { return s + '@ticker'; }).join('/');
      var ws = new WebSocket('wss://stream.binance.com:9443/stream?streams=' + streams);

      ws.onmessage = function(event) {
        var data = JSON.parse(event.data);
        var symbol = data.stream.split('@')[0];
        var price = parseFloat(data.data.c);

        for (var coin in COIN_SYMBOLS) {
          if (COIN_SYMBOLS[coin] === symbol) {
            var el = document.getElementById('price-' + coin);
            if (el) {
              el.textContent = formatPrice(price);
              el.classList.remove('loading');
            }
            break;
          }
        }
      };

      ws.onerror = function() {
        document.querySelectorAll('.coin-price').forEach(function(el) {
          if (el.classList.contains('loading')) el.textContent = '-';
        });
      };
    }

    function formatPrice(price) {
      if (price >= 1000) return '$' + price.toLocaleString('en-US', { maximumFractionDigits: 0 });
      else if (price >= 1) return '$' + price.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
      else return '$' + price.toLocaleString('en-US', { minimumFractionDigits: 4, maximumFractionDigits: 4 });
    }

    // Load CSV data
    async function loadCoinData(coin) {
      if (coinData[coin]) return coinData[coin];
      try {
        var response = await fetch('https://raw.githubusercontent.com/kittycapital/crypto-history/main/data/' + coin + '.csv');
        var text = await response.text();
        var lines = text.trim().split('\n');
        var data = [];
        for (var i = 1; i < lines.length; i++) {
          var parts = lines[i].split(',');
          var dateStr = parts[0];
          var price = parseFloat(parts[1]);
          if (!isNaN(price) && dateStr) {
            var date = new Date(dateStr.replace(' UTC', ''));
            data.push({ date: date, price: price });
          }
        }
        data.sort(function(a, b) { return a.date - b.date; });
        coinData[coin] = data;
        return data;
      } catch (error) {
        console.error('Failed to load ' + coin + ' data:', error);
        return [];
      }
    }

    // Calculate monthly returns
    function calculateMonthlyReturns(data) {
      var monthlyData = {};
      data.forEach(function(d) {
        var year = d.date.getFullYear(), month = d.date.getMonth(), day = d.date.getDate();
        var key = year + '-' + month;
        if (!monthlyData[key]) monthlyData[key] = { year: year, month: month, days: {} };
        monthlyData[key].days[day] = d.price;
      });
      var returns = [];
      for (var key in monthlyData) {
        var m = monthlyData[key];
        var days = Object.keys(m.days).map(Number).sort(function(a, b) { return a - b; });
        if (days.length >= 2) {
          var openPrice = m.days[days[0]];
          var closePrice = m.days[days[days.length - 1]];
          var returnPct = ((closePrice - openPrice) / openPrice) * 100;
          returns.push({ year: m.year, month: m.month, return: returnPct, days: m.days });
        }
      }
      return returns;
    }

    // Get historical data for specific month across all years
    function getMonthHistoricalData(data, targetMonth) {
      var monthlyData = {};
      var currentYear = new Date().getFullYear();
      var currentMonthFirstPrice = null;

      data.forEach(function(d) {
        var year = d.date.getFullYear(), month = d.date.getMonth(), day = d.date.getDate();
        if (month === targetMonth) {
          if (!monthlyData[year]) monthlyData[year] = {};
          monthlyData[year][day] = d.price;
        }
      });

      if (monthlyData[currentYear]) {
        var currentYearDays = Object.keys(monthlyData[currentYear]).map(Number).sort(function(a, b) { return a - b; });
        if (currentYearDays.length > 0) currentMonthFirstPrice = monthlyData[currentYear][currentYearDays[0]];
      }

      var results = [];
      for (var year in monthlyData) {
        var days = monthlyData[year];
        var dayNumbers = Object.keys(days).map(Number).sort(function(a, b) { return a - b; });
        if (dayNumbers.length >= 2) {
          var firstPrice = days[dayNumbers[0]];
          var normalized = dayNumbers.map(function(day) {
            var returnPct = ((days[day] - firstPrice) / firstPrice) * 100;
            var projectedPrice = currentMonthFirstPrice ? currentMonthFirstPrice * (1 + returnPct / 100) : days[day];
            return { day: day, return: returnPct, price: projectedPrice };
          });
          var lastReturn = normalized[normalized.length - 1].return;
          results.push({ year: parseInt(year), data: normalized, totalReturn: lastReturn });
        }
      }
      return results.sort(function(a, b) { return a.year - b.year; });
    }

    // Create monthly performance chart
    function createChart(historicalData, currentMonth) {
      var ctx = document.getElementById('performanceChart').getContext('2d');
      if (chart) chart.destroy();

      var currentYear = new Date().getFullYear();
      var datasets = [];
      var bestYear = null, worstYear = null, bestReturn = -Infinity, worstReturn = Infinity;

      historicalData.forEach(function(yearData) {
        if (yearData.totalReturn > bestReturn) { bestReturn = yearData.totalReturn; bestYear = yearData.year; }
        if (yearData.totalReturn < worstReturn) { worstReturn = yearData.totalReturn; worstYear = yearData.year; }
      });

      var maxDays = Math.max.apply(null, historicalData.map(function(y) { return y.data.length; }));
      var avgData = [];
      for (var i = 0; i < maxDays; i++) {
        var sum = 0, count = 0;
        historicalData.forEach(function(yearData) {
          if (yearData.data[i]) { sum += yearData.data[i].return; count++; }
        });
        if (count > 0) avgData.push({ x: i + 1, y: sum / count });
      }

      // Faded historical lines
      historicalData.forEach(function(yearData) {
        var isBest = yearData.year === bestYear, isWorst = yearData.year === worstYear;
        var isCurrent = yearData.year === currentYear, isSelected = yearData.year === selectedYear;
        if (!isBest && !isWorst && !isCurrent && !isSelected) {
          datasets.push({
            label: yearData.year.toString(),
            data: yearData.data.map(function(d) { return { x: d.day, y: d.return, price: d.price }; }),
            borderColor: 'rgba(255,255,255,0.12)', borderWidth: 1.5, fill: false, tension: 0.3,
            pointRadius: 0, pointHoverRadius: 4, pointHoverBackgroundColor: 'rgba(255,255,255,0.8)'
          });
        }
      });

      // Average line
      datasets.push({ label: '평균', data: avgData, borderColor: '#888', borderWidth: 2, borderDash: [5, 5], fill: false, tension: 0.3, pointRadius: 0 });

      // Selected year
      if (selectedYear) {
        var selectedData = historicalData.find(function(y) { return y.year === selectedYear; });
        if (selectedData) {
          datasets.push({
            label: selectedYear + ' (선택)',
            data: selectedData.data.map(function(d) { return { x: d.day, y: d.return, price: d.price }; }),
            borderColor: '#60a5fa', borderWidth: 3, fill: false, tension: 0.3, pointRadius: 0
          });
        }
      }

      // Worst year
      var worstData = historicalData.find(function(y) { return y.year === worstYear; });
      if (worstData) {
        datasets.push({
          label: worstYear + ' (역대 최저)',
          data: worstData.data.map(function(d) { return { x: d.day, y: d.return, price: d.price }; }),
          borderColor: '#ef4444', borderWidth: 2.5, fill: false, tension: 0.3, pointRadius: 0
        });
      }

      // Best year
      var bestData = historicalData.find(function(y) { return y.year === bestYear; });
      if (bestData) {
        datasets.push({
          label: bestYear + ' (역대 최고)',
          data: bestData.data.map(function(d) { return { x: d.day, y: d.return, price: d.price }; }),
          borderColor: '#22c55e', borderWidth: 2.5, fill: false, tension: 0.3, pointRadius: 0
        });
      }

      // Current year
      var currentData = historicalData.find(function(y) { return y.year === currentYear; });
      if (currentData) {
        datasets.push({
          label: currentYear + ' (현재)',
          data: currentData.data.map(function(d) { return { x: d.day, y: d.return, price: d.price }; }),
          borderColor: '#f59e0b', borderWidth: 3, fill: false, tension: 0.3, pointRadius: 2, pointBackgroundColor: '#f59e0b'
        });
      }

      chart = new Chart(ctx, {
        type: 'line',
        plugins: [watermarkPlugin],
        data: { datasets: datasets },
        options: {
          responsive: true, maintainAspectRatio: false,
          interaction: { mode: 'nearest', intersect: false },
          plugins: {
            legend: { display: false },
            tooltip: {
              backgroundColor: 'rgba(10,10,10,0.95)', titleColor: '#e5e5e5', bodyColor: '#8a8a8a',
              borderColor: 'rgba(255,255,255,0.08)', borderWidth: 1, padding: 12, displayColors: true,
              callbacks: {
                title: function(items) { return items.length > 0 ? (currentMonth + 1) + '월 ' + Math.round(items[0].parsed.x) + '일' : ''; },
                label: function(context) {
                  var value = context.parsed.y, sign = value >= 0 ? '+' : '';
                  var rawData = context.raw, priceStr = '';
                  if (rawData && rawData.price !== undefined) {
                    var price = rawData.price;
                    if (price >= 1000) priceStr = ' ($' + price.toLocaleString('en-US', { maximumFractionDigits: 0 }) + ')';
                    else if (price >= 1) priceStr = ' ($' + price.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) + ')';
                    else priceStr = ' ($' + price.toLocaleString('en-US', { minimumFractionDigits: 4, maximumFractionDigits: 4 }) + ')';
                  }
                  return ' ' + context.dataset.label + ': ' + sign + value.toFixed(2) + '%' + priceStr;
                }
              }
            }
          },
          scales: {
            x: { type: 'linear', min: 1, max: 31, title: { display: true, text: '일', color: '#888' }, grid: { color: 'rgba(255,255,255,0.03)' }, ticks: { color: '#888', stepSize: 5 } },
            y: { title: { display: true, text: '수익률 (%)', color: '#888' }, grid: { color: 'rgba(255,255,255,0.03)' }, ticks: { color: '#888', callback: function(v) { return (v >= 0 ? '+' : '') + v + '%'; } } }
          }
        }
      });
    }

    // Create heatmap
    function createHeatmap(returns, currentMonth) {
      var tbody = document.getElementById('heatmapBody');
      var tfoot = document.getElementById('heatmapFoot');
      tbody.innerHTML = '';
      tfoot.innerHTML = '';

      var yearlyData = {};
      returns.forEach(function(r) {
        if (!yearlyData[r.year]) yearlyData[r.year] = {};
        yearlyData[r.year][r.month] = r.return;
      });

      var years = Object.keys(yearlyData).map(Number).sort(function(a, b) { return b - a; });
      var currentYear = new Date().getFullYear();

      // Calculate statistics (excluding current year)
      var stats = { best: {}, worst: {}, avg: {} };
      for (var month = 0; month < 12; month++) {
        var values = [];
        years.forEach(function(year) {
          if (year !== currentYear && yearlyData[year][month] !== undefined) values.push(yearlyData[year][month]);
        });
        if (values.length > 0) {
          stats.best[month] = Math.max.apply(null, values);
          stats.worst[month] = Math.min.apply(null, values);
          stats.avg[month] = values.reduce(function(a, b) { return a + b; }, 0) / values.length;
        }
      }

      window.monthlyStats = stats;
      updateSidebar(stats, currentMonth, returns, currentYear);

      // Build rows
      years.forEach(function(year) {
        var row = document.createElement('tr');
        row.dataset.year = year;

        var yearCell = document.createElement('td');
        yearCell.className = 'year-cell';
        yearCell.textContent = year;
        row.appendChild(yearCell);

        for (var m = 0; m < 12; m++) {
          var cell = document.createElement('td');
          var value = yearlyData[year][m];
          if (value !== undefined) {
            var span = document.createElement('span');
            span.className = 'heatmap-cell';
            if (value > 0) { span.classList.add('positive'); span.textContent = '+' + value.toFixed(1) + '%'; }
            else if (value < 0) { span.classList.add('negative'); span.textContent = value.toFixed(1) + '%'; }
            else { span.classList.add('neutral'); span.textContent = '0.0%'; }
            if (m === currentMonth && year === currentYear) span.classList.add('current-month');
            cell.appendChild(span);
          }
          row.appendChild(cell);
        }

        row.addEventListener('click', function() {
          var wasSelected = row.classList.contains('selected');
          document.querySelectorAll('.heatmap-table tr.selected').forEach(function(r) { r.classList.remove('selected'); });
          if (wasSelected) { selectedYear = null; }
          else { row.classList.add('selected'); selectedYear = parseInt(row.dataset.year); }
          updateChart();
        });

        tbody.appendChild(row);
      });

      // Stats footer
      var statRows = [
        { key: 'best', label: '최고', className: 'stat-best' },
        { key: 'worst', label: '최저', className: 'stat-worst' },
        { key: 'avg', label: '평균', className: 'stat-avg' }
      ];

      statRows.forEach(function(stat) {
        var row = document.createElement('tr');
        var labelCell = document.createElement('td');
        labelCell.className = 'stat-label ' + stat.className;
        labelCell.textContent = stat.label;
        row.appendChild(labelCell);
        for (var m = 0; m < 12; m++) {
          var cell = document.createElement('td');
          cell.className = stat.className;
          var value = stats[stat.key][m];
          if (value !== undefined) {
            var sign = value >= 0 ? '+' : '';
            cell.textContent = sign + value.toFixed(1) + '%';
          }
          row.appendChild(cell);
        }
        tfoot.appendChild(row);
      });
    }

    // Update sidebar summary
    function updateSidebar(stats, currentMonth, returns, currentYear) {
      var avg = stats.avg[currentMonth], best = stats.best[currentMonth], worst = stats.worst[currentMonth];
      document.getElementById('side-avg').textContent = avg !== undefined ? (avg >= 0 ? '+' : '') + avg.toFixed(1) + '%' : '--';
      document.getElementById('side-best').textContent = best !== undefined ? '+' + best.toFixed(1) + '%' : '--';
      document.getElementById('side-worst').textContent = worst !== undefined ? worst.toFixed(1) + '%' : '--';
      var wins = 0, total = 0;
      returns.forEach(function(r) {
        if (r.month === currentMonth && r.year !== currentYear) { total++; if (r.return > 0) wins++; }
      });
      document.getElementById('side-winrate').textContent = total > 0 ? Math.round(wins / total * 100) + '%' : '--';
    }

    function updateChartTitle(coin, month) {
      document.getElementById('chart-title').textContent = (COIN_NAMES_KR[coin] || coin) + ' ' + MONTH_NAMES_KR[month] + ', 과거엔 어땠을까?';
    }

    // Yearly scenario data
    function getYearlyData(data) {
      var yearlyData = {};
      var currentYear = new Date().getFullYear();
      data.forEach(function(d) {
        var year = d.date.getFullYear(), month = d.date.getMonth(), day = d.date.getDate();
        if (!yearlyData[year]) yearlyData[year] = {};
        if (!yearlyData[year][month]) yearlyData[year][month] = {};
        yearlyData[year][month][day] = d.price;
      });
      var basePrice = null;
      if (yearlyData[currentYear] && yearlyData[currentYear][0]) {
        var janDays = Object.keys(yearlyData[currentYear][0]).map(Number).sort(function(a, b) { return a - b; });
        if (janDays.length > 0) basePrice = yearlyData[currentYear][0][janDays[0]];
      }
      return { yearlyData: yearlyData, basePrice: basePrice, currentYear: currentYear };
    }

    function calculateYearlyScenarios(data, monthlyReturns) {
      var yd = getYearlyData(data);
      if (!yd.basePrice) return null;
      var yearlyData = yd.yearlyData, basePrice = yd.basePrice, currentYear = yd.currentYear;
      var years = Object.keys(yearlyData).map(Number).filter(function(y) { return y !== currentYear; }).sort();

      var yearlyReturns = {};
      monthlyReturns.forEach(function(r) {
        if (r.year !== currentYear) {
          if (!yearlyReturns[r.year]) yearlyReturns[r.year] = {};
          yearlyReturns[r.year][r.month] = r.return;
        }
      });

      var scenarios = [];
      var bestYear = null, worstYear = null, bestFinalReturn = -Infinity, worstFinalReturn = Infinity;

      years.forEach(function(year) {
        if (!yearlyReturns[year]) return;
        var points = [];
        var cumulativePrice = basePrice;
        for (var month = 0; month < 12; month++) {
          var monthReturn = yearlyReturns[year][month];
          if (monthReturn !== undefined) cumulativePrice = cumulativePrice * (1 + monthReturn / 100);
          points.push({ month: month, price: cumulativePrice });
        }
        var finalReturn = ((cumulativePrice - basePrice) / basePrice) * 100;
        if (finalReturn > bestFinalReturn) { bestFinalReturn = finalReturn; bestYear = year; }
        if (finalReturn < worstFinalReturn) { worstFinalReturn = finalReturn; worstYear = year; }
        scenarios.push({ year: year, data: points, finalReturn: finalReturn });
      });

      var stats = window.monthlyStats;
      var avgPoints = [];
      var avgPrice = basePrice;
      for (var month = 0; month < 12; month++) {
        if (stats.avg[month] !== undefined) avgPrice = avgPrice * (1 + stats.avg[month] / 100);
        avgPoints.push({ month: month, price: avgPrice });
      }

      var currentYearPoints = [];
      if (yearlyData[currentYear]) {
        var lastKnownPrice = basePrice;
        for (var month = 0; month < 12; month++) {
          if (yearlyData[currentYear][month]) {
            var days = Object.keys(yearlyData[currentYear][month]).map(Number).sort(function(a, b) { return a - b; });
            if (days.length > 0) {
              lastKnownPrice = yearlyData[currentYear][month][days[days.length - 1]];
              currentYearPoints.push({ month: month, price: lastKnownPrice });
            }
          }
        }
      }

      return { scenarios: scenarios, bestYear: bestYear, worstYear: worstYear, avgData: avgPoints, currentYearData: currentYearPoints, basePrice: basePrice, currentYear: currentYear };
    }

    // Create yearly scenario chart
    function createYearlyChart(data, monthlyReturns) {
      var ctx = document.getElementById('yearlyChart').getContext('2d');
      if (yearlyChart) yearlyChart.destroy();

      var scenarioData = calculateYearlyScenarios(data, monthlyReturns);
      if (!scenarioData) return;

      var scenarios = scenarioData.scenarios, bestYear = scenarioData.bestYear, worstYear = scenarioData.worstYear;
      var avgData = scenarioData.avgData, currentYearData = scenarioData.currentYearData;
      var basePrice = scenarioData.basePrice, currentYear = scenarioData.currentYear;
      var datasets = [];

      // Faded historical lines
      scenarios.forEach(function(scenario) {
        if (scenario.year !== bestYear && scenario.year !== worstYear) {
          datasets.push({
            label: scenario.year.toString(),
            data: scenario.data.map(function(d) { return { x: d.month, y: d.price }; }),
            borderColor: 'rgba(255,255,255,0.1)', borderWidth: 1.5, fill: false, tension: 0.3,
            pointRadius: 0, pointHoverRadius: 4
          });
        }
      });

      // Average
      datasets.push({ label: '평균', data: avgData.map(function(d) { return { x: d.month, y: d.price }; }), borderColor: '#888', borderWidth: 2, borderDash: [5, 5], fill: false, tension: 0.3, pointRadius: 0 });

      // Worst
      var worstScenario = scenarios.find(function(s) { return s.year === worstYear; });
      if (worstScenario) {
        datasets.push({ label: worstYear + ' (역대 최저)', data: worstScenario.data.map(function(d) { return { x: d.month, y: d.price }; }), borderColor: '#ef4444', borderWidth: 2.5, fill: false, tension: 0.3, pointRadius: 0 });
      }

      // Best
      var bestScenario = scenarios.find(function(s) { return s.year === bestYear; });
      if (bestScenario) {
        datasets.push({ label: bestYear + ' (역대 최고)', data: bestScenario.data.map(function(d) { return { x: d.month, y: d.price }; }), borderColor: '#22c55e', borderWidth: 2.5, fill: false, tension: 0.3, pointRadius: 0 });
      }

      // Current year
      if (currentYearData.length > 0) {
        datasets.push({ label: currentYear + ' (현재)', data: currentYearData.map(function(d) { return { x: d.month, y: d.price }; }), borderColor: '#f59e0b', borderWidth: 3, fill: false, tension: 0.3, pointRadius: 3, pointBackgroundColor: '#f59e0b' });
      }

      document.getElementById('yearly-chart-title').textContent = currentYear + '년 ' + (COIN_NAMES_KR[currentCoin] || currentCoin) + ' 가격 시나리오';

      yearlyChart = new Chart(ctx, {
        type: 'line',
        plugins: [watermarkPlugin],
        data: { datasets: datasets },
        options: {
          responsive: true, maintainAspectRatio: false,
          interaction: { mode: 'nearest', intersect: false },
          plugins: {
            legend: { display: false },
            tooltip: {
              backgroundColor: 'rgba(10,10,10,0.95)', titleColor: '#e5e5e5', bodyColor: '#8a8a8a',
              borderColor: 'rgba(255,255,255,0.08)', borderWidth: 1, padding: 12, displayColors: true,
              callbacks: {
                title: function(items) { return items.length > 0 ? MONTH_NAMES_KR[Math.round(items[0].parsed.x)] || '' : ''; },
                label: function(context) {
                  var price = context.parsed.y, formattedPrice = formatPrice(price);
                  var returnPct = ((price - basePrice) / basePrice) * 100;
                  var sign = returnPct >= 0 ? '+' : '';
                  return ' ' + context.dataset.label + ': ' + formattedPrice + ' (' + sign + returnPct.toFixed(1) + '%)';
                }
              }
            }
          },
          scales: {
            x: { type: 'linear', min: 0, max: 11, title: { display: true, text: '월', color: '#888' }, grid: { color: 'rgba(255,255,255,0.03)' }, ticks: { color: '#888', stepSize: 1, callback: function(value) { return MONTH_NAMES_KR[value] || ''; } } },
            y: { title: { display: true, text: '가격 (USD)', color: '#888' }, grid: { color: 'rgba(255,255,255,0.03)' }, ticks: { color: '#888', callback: function(value) { return formatPrice(value); } } }
          }
        }
      });
    }

    // Main update function
    async function updateChart() {
      var data = await loadCoinData(currentCoin);
      if (data.length === 0) return;

      var currentMonth = new Date().getMonth();
      var currentYear = new Date().getFullYear();

      document.getElementById('current-year').textContent = currentYear;
      updateChartTitle(currentCoin, currentMonth);

      var historicalData = getMonthHistoricalData(data, currentMonth);
      createChart(historicalData, currentMonth);

      var monthlyReturns = calculateMonthlyReturns(data);
      createHeatmap(monthlyReturns, currentMonth);
      createYearlyChart(data, monthlyReturns);

      updateSharePreview();
    }

    // Tab click handlers
    document.querySelectorAll('.coin-tab').forEach(function(tab) {
      tab.addEventListener('click', function() {
        document.querySelectorAll('.coin-tab').forEach(function(t) { t.classList.remove('active'); });
        tab.classList.add('active');
        currentCoin = tab.dataset.coin;
        selectedYear = null;
        document.querySelectorAll('.heatmap-table tr.selected').forEach(function(r) { r.classList.remove('selected'); });
        updateChart();
      });
    });

    // Initialize
    document.addEventListener('DOMContentLoaded', function() {
      initWebSocket();
      updateChart();
    });
  </script>
</body>
</html>
